<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paxi Pioneers (Bundel Lokal)</title>
  <style>
    /* --- AWAL PERUBAHAN CSS --- */
    
    /* Global & Tipografi */
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      background: #0d1117;
      color: #e6edf3;
      line-height: 1.6; /* Readability */
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Header & Navigasi */
    header {
      /* Efek Kaca (Glassmorphism) */
      background: #0d1117e6; 
      backdrop-filter: blur(12px);
      border-bottom: 1px solid #22272f; /* Border lebih halus */
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 24px;
      position: sticky;
      top: 0;
      z-index: 20;
      box-shadow: 0 2px 10px #00000033; /* Bayangan halus */
    }

    h2 {
      margin: 0;
      font-size: 22px;
      /* Teks Gradien Keren */
      background: linear-gradient(90deg, #a5b4fc, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 700;
    }
    
    h3 {
      font-weight: 600;
      border-bottom: 1px solid #2a2f36;
      padding-bottom: 8px;
    }

    /* Layout & Kartu */
    .wrap {
      max-width: 980px;
      margin: 40px auto;
      padding: 0 20px; /* Padding di body/wrap, bukan di main */
    }

    .card {
      background: #161b22;
      border: 1px solid #30363d; /* Border sedikit lebih cerah */
      border-radius: 12px;
      padding: 24px; /* Padding lebih besar */
      margin-bottom: 24px;
      box-shadow: 0 4px 12px #00000022; /* Bayangan kartu */
    }

    .row {
      display: flex;
      gap: 16px; /* Spasi lebih besar */
      align-items: center;
      margin-bottom: 16px; /* Ganti margin atas/bawah */
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .row:last-child {
      margin-bottom: 0;
    }

    /* Tombol & Interaksi */
    button {
      padding: 10px 16px;
      border-radius: 8px;
      border: 1px solid #30363d;
      background: #21262d;
      color: #e6edf3;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s ease; /* Transisi untuk semua properti */
    }

    button:hover {
      background: #30363d;
      border-color: #40464d;
      transform: translateY(-1px); /* Efek angkat */
    }
    
    button:active {
      transform: translateY(0);
    }

    button.primary, .wallet-btn {
      background: linear-gradient(45deg, #2563eb, #3b82f6);
      border: none;
      color: white;
      box-shadow: 0 2px 8px #3b82f644;
    }

    button.primary:hover, .wallet-btn:hover {
      background: linear-gradient(45deg, #3b82f6, #60a5fa);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px #3b82f666;
    }

    /* Input Form */
    input[type="number"] {
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #30363d;
      background: #0d1117;
      color: #e6edf3;
      font-size: 15px;
      transition: all 0.2s ease;
      width: 80px;
    }
    
    input[type="number"]:focus {
      /* Efek focus yang jelas */
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px #3b82f633;
    }

    .muted {
      color: #8ea1c0;
      font-size: 14px;
    }

    pre {
      background: #0d1117;
      border: 1px solid #2a2f36;
      color: #c9d1d9;
      padding: 12px;
      border-radius: 8px;
      overflow: auto;
      font-size: 13px;
      line-height: 1.4;
    }
    /* Log spacing: compact but with small breathing space */
    pre#log { background: transparent; border: 0; padding: 6px 0 8px; margin: 0; line-height: 1; }

    /* Wallet Dropdown */
    .wallet {
      position: relative;
    }
    
    .wallet-menu {
      display: none;
      position: absolute;
      right: 0;
      margin-top: 8px;
      /* Efek Kaca */
      background: #161b22cc;
      backdrop-filter: blur(8px);
      border: 1px solid #30363d;
      border-radius: 8px;
      overflow: hidden;
      min-width: 180px;
      z-index: 30;
      box-shadow: 0 4px 20px #00000044;
    }

    .wallet-menu button {
      border: none;
      background: none;
      width: 100%;
      padding: 12px 16px;
      text-align: left;
      color: #e6edf3;
      font-weight: 500;
      border-radius: 0;
      transition: background 0.2s ease;
    }

    .wallet-menu button:hover {
      background: #3b82f644; /* Hover dengan warna aksen */
      color: #fff;
      transform: none;
    }
    
    .wallet.open .wallet-menu {
      display: block;
      animation: fadeIn 0.15s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* NFT Gallery */
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
    }

    .nft {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 10px;
      overflow: hidden;
      transition: all 0.2s ease-in-out; /* Transisi untuk hover */
      box-shadow: 0 2px 4px #00000022;
    }
    
    .nft:hover {
      /* Efek Pop-out Keren */
      transform: translateY(-4px) scale(1.03);
      box-shadow: 0 8px 16px #00000044;
      border-color: #3b82f6;
    }

    .nft img {
      width: 100%;
      aspect-ratio: 1/1;
      object-fit: cover;
      display: block;
      border-bottom: 1px solid #30363d;
    }

    .nft p {
      margin: 0;
      padding: 12px 8px;
      font-size: 13px;
      color: #e6edf3; /* Dibuat lebih cerah */
      font-weight: 600;
      text-align: center;
      word-break: break-all;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 24px;
      font-size: 13px;
      color: #8ea1c0;
      border-top: 1px solid #22272f;
      background: #0d1117; /* Samakan dengan body */
      margin-top: 40px;
    }

    /* --- AKHIR PERUBAHAN CSS --- */
    /* Tambahan style untuk hero, stepper, dan progress */
    :root { --stroke:#263042; --accent:#6b5bff; --accent2:#3ab7ff; }
    .hero { margin: 32px auto 24px; padding: 28px; border:1px solid var(--stroke); border-radius:20px; background: radial-gradient(100% 120% at 0% 0%, #1a2140 0%, #0d1117 60%); text-align:center; box-shadow:0 8px 40px #0006; }
    .hero h1 { margin:0 0 8px; font-size:40px; font-weight:800; letter-spacing:.2px; color:#e8ecff; }
    .hero p { margin:0; color:#b6c4e3; }
    .stepper { display:flex; align-items:center; gap:10px; border:1px solid #2a2f36; background:#0f141e; padding:8px; border-radius:16px; }
    .stepper button { width:36px; height:36px; border-radius:12px; display:flex; align-items:center; justify-content:center; background:#1b2230; border:1px solid #2a2f36; color:#e6edf3; }
    .stepper input { width:72px; text-align:center; background:transparent; border:none; color:#e6edf3; }
    .progress { height:10px; border-radius:999px; background:#1b2436; border:1px solid #2a3550; overflow:hidden; }
    .progress > .fill { height:100%; width:0%; background: linear-gradient(90deg, var(--accent2), var(--accent)); transition: width .4s ease; }
    /* Status + toast */
    .status-card { background:#0f141e; border:1px solid #273046; border-radius:12px; padding:2px 6px; color:#cfe1ff; line-height:1; }
    .status-title { font-weight:700; margin:0; display:flex; align-items:center; gap:8px; }
    .status-title .ico { width:16px; height:16px; display:inline-block; border-radius:50%; }
    .ico-success { background: #22c55e; box-shadow: 0 0 0 2px #22c55e22; }
    .ico-error { background: #ef4444; box-shadow: 0 0 0 2px #ef444422; }
    .ico-info { background: #60a5fa; box-shadow: 0 0 0 2px #60a5fa22; }
    .ico-pending { background: #eab308; box-shadow: 0 0 0 2px #eab30822; }
    .status-sub { margin:0; color:#97aacb; font-size:12px; }
    .status-actions { display:flex; gap:10px; flex-wrap:wrap; margin:0; }
    .status-actions:empty { display:none; }
    .status-sub:empty { display:none; }
    .btn-link { background:#1b2230; border:1px solid #2a2f36; color:#d6e3ff; border-radius:8px; padding:6px 10px; cursor:pointer; font-size:12px; }
    /* details removed (no longer shown) */
    .toast-wrap { position:fixed; bottom:14px; left:50%; transform:translateX(-50%); display:flex; flex-direction:column; gap:8px; z-index:50; }
    .toast { display:flex; align-items:center; gap:10px; background:#0f141e; color:#d6e3ff; border:1px solid #2b3550; border-radius:10px; padding:10px 12px; box-shadow:0 6px 20px #0008; font-size:13px; min-width:260px; opacity:0; transform:translateY(8px); }
    .toast .ico { width:10px; height:10px; border-radius:50%; display:inline-block; }
    .toast.success .ico { background:#22c55e; box-shadow:0 0 0 2px #22c55e33; }
    .toast.error .ico { background:#ef4444; box-shadow:0 0 0 2px #ef444433; }
    .toast.info .ico { background:#60a5fa; box-shadow:0 0 0 2px #60a5fa33; }
    .toast.pending .ico { background:#eab308; box-shadow:0 0 0 2px #eab30833; }
    /* Animations */
    @keyframes toastIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
    @keyframes toastOut { from { opacity:1; transform:translateY(0); } to { opacity:0; transform:translateY(8px); } }
    .toast.show { animation: toastIn 200ms ease-out forwards; }
    .toast.hide { animation: toastOut 200ms ease-in forwards; }
    /* Wallet chooser */
    .chooser-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.5); display:flex; align-items:center; justify-content:center; z-index:60; }
    .chooser-panel { width: min(440px, 92%); background:#0f141e; border:1px solid #2b3550; border-radius:14px; padding:16px; box-shadow:0 14px 40px #0009; color:#d6e3ff; }
    .chooser-panel h3 { margin:0 0 8px; font-size:18px; }
    .chooser-panel p { margin:0 0 12px; color:#97aacb; font-size:13px; }
    .chooser-actions { display:flex; gap:10px; flex-wrap:wrap; }
    .chooser-btn { flex:1; padding:12px 14px; border-radius:10px; border:1px solid #2a2f36; background:#1a2452; color:#fff; cursor:pointer; font-weight:700; text-align:center; }
    .chooser-btn.secondary { background:#1b2230; color:#d6e3ff; }
    .chooser-close { margin-top:10px; display:block; width:100%; text-align:center; color:#9fb4db; cursor:pointer; font-size:12px; }
    /* Network badge */
    /* (removed net-badge in header to avoid clutter) */
    /* Debug panel */
    .debug-card { background:#0f141e; border:1px solid #273046; border-radius:12px; padding:10px; color:#cfe1ff; }
    .debug-card pre { margin:8px 0 0; background:#0b122b; border:1px solid rgba(255,255,255,.10); border-radius:8px; padding:8px; font-size:12px; max-height:32vh; overflow:auto; }
    /* Showcase: constrain image inside a fixed square frame */
    .showcase { display:flex; justify-content:center; margin:24px 0 14px; }
    .showcase .frame { width: min(420px, 100%); aspect-ratio: 1/1; border:1px solid #2a2f36; border-radius:14px; overflow:hidden; background: linear-gradient(180deg,#121a30,#0f1628); box-shadow: 0 6px 20px #0004; position:relative; }
    .showcase .frame img { width:100%; height:100%; object-fit: cover; display:block; }
    .showcase .badge { position:absolute; top:8px; left:8px; background:#1f2a48; color:#cfe1ff; border:1px solid #2a3758; font-size:12px; padding:4px 8px; border-radius:999px; }
  </style>
</head>
<body>
  <header>
    <h2>Paxi Pioneers</h2>
    <div class="wallet" id="walletBox">
      <button id="connectBtn" class="wallet-btn">Connect Wallet</button>
      <div class="wallet-menu" id="walletMenu">
        <button id="copyBtn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align:middle;margin-right:8px">
            <rect x="9" y="9" width="12" height="12" rx="2" stroke="#9fb4db" stroke-width="2"/>
            <rect x="3" y="3" width="12" height="12" rx="2" stroke="#9fb4db" stroke-width="2"/>
          </svg>
          Copy Address
        </button>
        <button id="disconnectBtn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align:middle;margin-right:8px">
            <path d="M15 3H6a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3h9" stroke="#ff6969" stroke-width="2"/>
            <path d="M10 17l5-5-5-5" stroke="#ff6969" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Disconnect
        </button>
      </div>
    </div>
  </header>

  <div class="wrap">
    <!-- Hero section -->
    <div class="hero">
      <h1>Join the Paxi Pioneers</h1>
      <p>Mint a Pioneer NFT and claim your spot in the galactic frontier. Limited to 10,000 unique explorers.</p>
    </div>
    <div class="card">
      <div class="showcase">
        <div class="frame">
          <img id="showcaseImg" alt="Pioneer" loading="lazy" decoding="async" />
        </div>
      </div>
      
      <div class="row" style="align-items:flex-end; justify-content:space-between;">
        <div style="display:flex; flex-direction:column; gap:6px;">
          <label style="margin:0; font-weight:600; color:#cfe1ff;">Quantity</label>
          <div class="stepper">
            <button type="button" id="qtyMinus">−</button>
            <input id="qty" type="number" min="1" max="10" value="1" />
            <button type="button" id="qtyPlus">+</button>
          </div>
        </div>
        <div>
          <button id="mint1Btn" class="primary">Mint</button>
        </div>
      </div>
      <div class="row">
        <div class="progress" style="flex:1; max-width:360px;">
          <div class="fill" id="progressFill"></div>
        </div>
        <span id="supply" class="muted"></span>
      </div>
      
      <div class="row" id="adminRow" style="display:none">
        <div class="muted">Admin Controls</div>
        <div>
          <button id="unpauseBtn">Unpause</button>
          <button id="pauseBtn">Pause</button>
          <button id="withdrawBtn">Withdraw</button>
        </div>
      </div>
      <pre id="log"></pre>
      <div class="debug-card" id="debugCard" style="display:none;">
        <div style="display:flex;align-items:center;gap:10px;justify-content:space-between;">
          <strong>Debug (txObj)</strong>
          <button id="debugToggle" class="btn-link">Hide</button>
        </div>
        <pre id="debugOut"></pre>
      </div>
    </div>

    <div class="card">
      <h3>NFT Gallery</h3>
      <div id="gallery" class="gallery">
        <p class="muted">No NFTs yet.</p>
      </div>
    </div>
    <!-- Panel Kontrol Admin: tersembunyi default, muncul jika wallet == admin -->
    <div class="card" id="adminPanel" style="display: none;">
      <h3>Admin Controls</h3>
      <p>Saldo: <span id="balanceDisplay">...</span></p>
      <div class="row">
        <button id="withdrawButton">Withdraw Funds</button>
        <button id="pauseButton">Pause Mint</button>
        <button id="unpauseButton">Unpause Mint</button>
      </div>
      <div class="row">
        <div>
          <label>Update Base URI</label><br>
          <input id="uriInput" type="text" placeholder="ipfs://.../" style="min-width:320px" />
          <button id="updateUriButton">Update Base URI</button>
        </div>
      </div>
      <div class="row">
        <div>
          <label>Set Provenance Hash</label><br>
          <input id="hashInput" type="text" placeholder="sha256..." style="min-width:320px" />
          <button id="setHashButton">Set Provenance Hash</button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    © 2025 Paxi Pioneers
  </footer>

  <script src="bundle.js"></script>
  <!-- PaxiHub helper (provides window.PaxiCosmJS in PaxiHub webview) -->
  <script src="https://mainnet-api.paxinet.io/resources/js/paxi-cosmjs.umd.js"></script>
  <script>
    // Placeholder explorer base (easy to replace later)
    const EXPLORER_BASE = 'https://explorer.placeholder/tx/';
    const TOAST_TTL = 4200;
    const toastWrap = document.createElement('div'); toastWrap.className='toast-wrap'; document.addEventListener('DOMContentLoaded',()=>document.body.appendChild(toastWrap));
    const toast = (msg, type='info')=>{
      const el=document.createElement('div');
      el.className='toast '+type+' show';
      el.innerHTML=`<span class="ico"></span><span>${msg}</span>`;
      toastWrap.appendChild(el);
      const hideDelay = Math.max(150, TOAST_TTL - 180);
      setTimeout(()=>{ el.classList.remove('show'); el.classList.add('hide'); }, hideDelay);
      setTimeout(()=>{ el.remove(); }, hideDelay + 200);
    };

    // Deteksi perangkat & preferensi wallet
    const isMobile = ()=> /Android|iPhone|iPad|iPod|Windows Phone/i.test(navigator.userAgent||'');
    const getWalletPref = ()=> localStorage.getItem('wallet_pref')||'';
    const setWalletPref = (v)=> localStorage.setItem('wallet_pref', v);
    const openPaxiHub = ()=> { try{ const u=new URL(window.location.href); window.location.href = 'paxi://hub/explorer?url='+encodeURIComponent(u.toString()); }catch(e){} };
    function showWalletChooser({mode}){
      const bd=document.createElement('div'); bd.className='chooser-backdrop';
      const panel=document.createElement('div'); panel.className='chooser-panel';
      const title = mode==='both'? 'Pilih Wallet' : 'Buka di aplikasi wallet';
      const desc  = mode==='both'? 'Silakan pilih dompet yang ingin digunakan untuk terhubung.' : 'Tidak menemukan wallet terpasang. Pilih salah satu opsi di bawah ini.';
      panel.innerHTML = `<h3>${title}</h3><p>${desc}</p>
        <div class="chooser-actions">
          <button class="chooser-btn" id="btnOpenPaxiHub">Buka di PaxiHub</button>
          <button class="chooser-btn secondary" id="btnOpenKeplr">Buka di Keplr</button>
        </div>
        <span class=\"chooser-close\" id=\"btnChooserClose\">Tutup</span>`;
      bd.appendChild(panel); document.body.appendChild(bd);
      const close=()=> bd.remove();
      panel.querySelector('#btnChooserClose').onclick=close;
      panel.querySelector('#btnOpenPaxiHub').onclick=()=>{ setWalletPref('paxihub'); close(); openPaxiHub(); };
      panel.querySelector('#btnOpenKeplr').onclick=()=>{ setWalletPref('keplr'); try{ navigator.clipboard.writeText(window.location.href).then(()=> toast('URL disalin. Buka via Keplr > Browser lalu tempel URL.','info')); }catch(e){} close(); };
    }
    // UI labels now in English
    const CONTRACT = 'paxi1rnraxu54huv7wkmpff3v8mzhqh49g0e60x4ehzws4ee6upcy78sqc55vx0';
    const RPC = 'https://testnet-rpc.paxinet.io';
    const LCD = 'https://testnet-lcd.paxinet.io';
    const CHAIN_ID = 'paxi-testnet';
    const DENOM = 'upaxi';
    const PRICE = 10_000_000;
    // Showcase image (square 1:1) seeded with provided address
    // Ganti ke CID IPFS Anda di Pinata; proxy ke WebP 512x512 agar ringan
    const SHOWCASE_IMG_ORIG = 'https://gateway.pinata.cloud/ipfs/bafybeibyndyoxo5mv3ki32r3sg4w35rottg445pcjkcgciuaecdyrb6al4';
    const SHOWCASE_IMG = 'https://images.weserv.nl/?url=' + encodeURIComponent(SHOWCASE_IMG_ORIG) + '&w=512&h=512&fit=cover&output=webp&q=72&we&il';
    // Optional: Pioneer game image (original URL), we will proxy + downscale to WebP for speed
    const SHOWCASE_GAME_IMG = '/paxi-mint-frontend/assets/pioneer-game.svg';

    const { SigningCosmWasmClient, GasPrice, calculateFee, coins } = window.Cosm;
    // Set showcase image src on load
    (function(){ const el=document.getElementById('showcaseImg'); if(!el) return; el.src = SHOWCASE_IMG; el.width=512; el.height=512; })();
    // Set game showcase with optimized delivery (WebP, 512x512) using images.weserv.nl proxy
    (function(){
      if (!SHOWCASE_GAME_IMG) return; // no game image configured
      const wrap = document.getElementById('gameShowcase');
      const img = document.getElementById('gameSrc');
      const webp = document.getElementById('gameSrcWebp');
      // Build optimized URLs (cover 1:1, width/height capped to 512)
      // If local SVG, use as-is (already lightweight); else proxy to optimized WebP
      if (SHOWCASE_GAME_IMG.endsWith('.svg')) {
        if (img) img.src = SHOWCASE_GAME_IMG;
      } else {
        const base = 'https://images.weserv.nl/?url=' + encodeURIComponent(SHOWCASE_GAME_IMG);
        const params = '&w=512&h=512&fit=cover&output=webp&we&il'; // webp progressive
        const webpUrl = base + params;
        const fallbackUrl = base + '&w=512&h=512&fit=cover';
        if (webp) webp.srcset = webpUrl;
        if (img) img.src = fallbackUrl;
      }
      if (wrap) wrap.style.display = '';
    })();
    // Helpers untuk PaxiHub signing ala PAXI Sender
    function toB64(bytes){ try{ let bin=''; bytes.forEach(b=> bin+=String.fromCharCode(b)); return btoa(bin); }catch{ return ''; } }
    function fromB64(str){ try{ const bin=atob(str); const out=new Uint8Array(bin.length); for(let i=0;i<bin.length;i++) out[i]=bin.charCodeAt(i); return out; }catch{ return new Uint8Array(); } }
    async function fetchChainIdFromLCD(){ const url = (LCD.replace(/\/$/,'') + '/cosmos/base/tendermint/v1beta1/node_info'); try{ const j = await fetch(url).then(r=>r.json()); return j && j.default_node_info ? j.default_node_info.network : CHAIN_ID; }catch{ return CHAIN_ID; } }
    async function fetchAccountLCD(addr){ const url = (LCD.replace(/\/$/,'') + '/cosmos/auth/v1beta1/accounts/' + addr); try{ const j = await fetch(url).then(r=>r.json()); const acc = j && j.account ? (j.account.base_account || j.account) : null; return acc ? { accountNumber: Number(acc.account_number||0), sequence: Number(acc.sequence||0) } : { accountNumber: 0, sequence: 0 }; }catch{ return { accountNumber: 0, sequence: 0 }; }
    }
    // Ensure gallery images have robust fallback
    function bindGalleryImageFallback(){
      document.querySelectorAll('#gallery img[data-token]').forEach(img=>{
        img.onerror = ()=>{
          const t = img.getAttribute('data-token')||'paxi';
          img.onerror=null; img.src = `https://picsum.photos/seed/${t}/400/400`;
        };
      });
    }
    const logEl = document.getElementById('log');
    const supplyEl = document.getElementById('supply');
    const qtyEl = document.getElementById('qty');
    const galleryEl = document.getElementById('gallery');
    const adminRow = document.getElementById('adminRow');
    const unpauseBtn = document.getElementById('unpauseBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const withdrawBtn = document.getElementById('withdrawBtn');
    // Admin Panel elements
    const adminPanel = document.getElementById('adminPanel');
    const balanceDisplay = document.getElementById('balanceDisplay');
    const withdrawButton = document.getElementById('withdrawButton');
    const pauseButton = document.getElementById('pauseButton');
    const unpauseButton = document.getElementById('unpauseButton');
    const uriInput = document.getElementById('uriInput');
    const updateUriButton = document.getElementById('updateUriButton');
    const hashInput = document.getElementById('hashInput');
    const setHashButton = document.getElementById('setHashButton');
    let client=null, address=null;
    let adminAddress=null, paused=false, maxSupply=10000;
    function shortHash(h){ if(!h) return ''; return h.slice(0,8)+'…'+h.slice(-8); }
    function mapError(e){
      const raw = (typeof e === 'string') ? e : (e?.error || e?.message || e?.txResponse?.raw_log || e?.toString?.() || '');
      const msg = (raw||'').toLowerCase();
      if(msg.includes('paused')) return 'Mint is currently paused by Admin.';
      if(msg.includes('invalid payment')) return 'Payment amount is invalid (price is 10 PAXI per NFT).';
      if(msg.includes('max supply')) return 'Max supply reached. No more mints available.';
      if(msg.includes('invalid quantity')||msg.includes('quantity')) return 'Quantity must be between 1 and 10.';
      if(msg.includes('request rejected')||msg.includes('rejected')) return 'Signature request was cancelled.';
      if(msg.includes('network')||msg.includes('lcd')||msg.includes('rpc')) return 'Network is busy. Please retry shortly.';
      return raw||'Unknown error.';
    }
    function linkTx(tx){ return EXPLORER_BASE ? (EXPLORER_BASE+tx) : '#'; }
    function setStatus(kind, title, sub, opts){
      const tx=opts?.txhash, raw=opts?.raw;
      const ico = kind==='success'?'ico-success': kind==='error'?'ico-error': kind==='pending'?'ico-pending':'ico-info';
      const html=`<div class="status-card">
        <div class="status-title"><span class="ico ${ico}"></span>${title||''}</div>
        <div class="status-sub">${sub||''}</div>
        <div class="status-actions">
          ${tx?`<a class="btn-link" href="${linkTx(tx)}" target="_blank" rel="noreferrer">View in Explorer</a>`:''}
          ${tx?`<button class="btn-link" id="copyTxBtn">Copy TX Hash (${shortHash(tx)})</button>`:''}
        </div>
      </div>`;
      logEl.innerHTML=html;
      const cpy=logEl.querySelector('#copyTxBtn');
      if(cpy&&tx){ cpy.onclick=()=>{ navigator.clipboard.writeText(tx); toast('TX hash copied'); }; }
    }
    // Log policy: only show TX hash in the status card; others as toasts
    const log=(m,o)=>{
      const mm=(m||'').toLowerCase();
      if(mm.startsWith('connected')){ toast('Wallet connected','success'); return; }
      if(mm.startsWith('failed to connect')){ toast('Failed to connect','error'); return; }
      if(mm.startsWith('disconnected')){ toast('Disconnected from wallet','info'); return; }
      if(mm.startsWith('sending')){ toast('Sending...','pending'); return; }
      if(mm.startsWith('success')){ const tx=o?.txhash; setStatus('success','Mint successful','', { txhash:tx }); toast('Mint success','success'); return; }
      if(mm.startsWith('mint error')){ toast(mapError(o||m),'error'); return; }
      if(mm.startsWith('admin error')){ toast(mapError(o||m),'error'); return; }
      // fallback: ignore or show minimal
    };

    async function lcdSmart(q){
      const json = JSON.stringify(q);
      const encStd = btoa(json);
      const encUrl = encStd.replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
      const base = LCD.replace(/\/$/,'');
      const decode = (js)=>{
        const b64 = js.data||js.result||js.smart||js.result_data||js.response?.data;
        if(!b64) return js;
        try{ const bytes=Uint8Array.from(atob(b64),c=>c.charCodeAt(0)); return JSON.parse(new TextDecoder().decode(bytes)); }catch{return{};}
      };
      // Try GET std
      try{ const rg = await fetch(`${base}/cosmwasm/wasm/v1/contract/${CONTRACT}/smart/${encStd}`); if(rg.ok){ return decode(await rg.json()); } }catch{}
      // Try GET url-safe
      try{ const rg = await fetch(`${base}/cosmwasm/wasm/v1/contract/${CONTRACT}/smart/${encUrl}`); if(rg.ok){ return decode(await rg.json()); } }catch{}
      // Try POST std
      try{ const rp = await fetch(`${base}/cosmwasm/wasm/v1/contract/${CONTRACT}/smart`,{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ query_data: encStd }) }); if(rp.ok){ return decode(await rp.json()); } }catch{}
      // Try POST url-safe
      const rp = await fetch(`${base}/cosmwasm/wasm/v1/contract/${CONTRACT}/smart`,{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ query_data: encUrl }) });
      if(rp.ok){ return decode(await rp.json()); }
      // Fallback to proxy API (hosted alongside app)
      try{
        const pr = await fetch('/api/smart', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ contract: CONTRACT, lcd: LCD, query: q }) });
        if(pr.ok){ const js=await pr.json(); return js.result || js || {}; }
      }catch{}
      throw new Error('Smart query failed');
    }

    async function getConfig(){
      try { return await lcdSmart({ get_config: {} }); } catch { return null; }
    }

    // Diagnostics helper: check contract info + minted via smart query
    async function runCheckContract(outEl){
      try{
        if(outEl) outEl.textContent = 'Checking...';
        const info = await lcdSmart({ contract_info: {} }).catch(()=>null);
        const num  = await lcdSmart({ num_tokens: {} }).catch(()=>null);
        if(!info){ if(outEl) outEl.textContent = 'Contract not found (smart query)'; toast('Check failed: contract not found','error'); return; }
        const n = (typeof num === 'object') ? (num.count ?? num.data?.count ?? num.result?.count ?? 0) : Number(num||0);
        const txt = `ok · name: ${info?.name||'-'} · symbol: ${info?.symbol||'-'} · minted: ${n}`;
        if(outEl) outEl.textContent = txt; toast('Check OK','success');
      }catch(e){ if(outEl) outEl.textContent = 'Error: '+(e?.message||'unknown'); toast('Check error: '+(e?.message||'unknown'),'error'); }
    }

    async function refresh(){ 
      try{ 
        const [rSupply, cfg] = await Promise.all([
          lcdSmart({num_tokens:{}}).catch(()=>null),
          getConfig()
        ]);
        const parseCount = (x)=>{
          if (x == null) return 0;
          if (typeof x === 'number') return x;
          if (typeof x === 'string') return Number(x) || 0;
          if (typeof x === 'object') return Number(x.count ?? x.data?.count ?? x.result?.count ?? 0) || 0;
          return 0;
        };
        // Ambil minted dari smart query, atau fallback ke get_config.total_minted
        let minted = parseCount(rSupply);
        if (!minted && cfg && typeof cfg.total_minted !== 'undefined') {
          const tm = Number(cfg.total_minted);
          if (!Number.isNaN(tm)) minted = tm;
        }
        if (cfg) {
          maxSupply = Number(cfg.max_supply || maxSupply);
          adminAddress = cfg.admin || null;
          paused = !!cfg.paused;
        }
        supplyEl.textContent=`${minted} / ${maxSupply} MINTED`; 
        // Toggle admin controls safely
        const isAdmin = !!address && !!adminAddress && address === adminAddress;
        if (adminRow) adminRow.style.display = isAdmin ? '' : 'none';
        // Pastikan panel admin ikut diperbarui
        await checkAdminAndTogglePanel();
      }catch{ 
        supplyEl.textContent='Supply: --'; 
        if (adminRow) adminRow.style.display='none';
      } 
    }

    async function connect(){
      try{
        const hasPaxiHub = !!(window.paxihub && window.paxihub.paxi);
        const hasKeplr   = !!window.keplr;
        const pref = getWalletPref();
        if (!hasPaxiHub && !hasKeplr && isMobile()) { showWalletChooser({mode:'none'}); return; }
        if (hasPaxiHub && hasKeplr && !pref && isMobile()) { showWalletChooser({mode:'both'}); return; }

        if (hasPaxiHub && (pref==='paxihub' || !hasKeplr)) {
          const info = await window.paxihub.paxi.getAddress();
          address = info.address;
          client = null;
          setWalletPref('paxihub');
          log('Connected', { address });
        } else if (hasKeplr) {
          // Suggest chain ke Keplr agar chain PAXI Testnet otomatis terdaftar
          try {
            if (window.keplr.experimentalSuggestChain) {
              await window.keplr.experimentalSuggestChain({
                chainId: CHAIN_ID,
                chainName: 'PAXI Testnet',
                rpc: RPC,
                rest: LCD,
                bip44: { coinType: 118 },
                bech32Config: {
                  bech32PrefixAccAddr: 'paxi',
                  bech32PrefixAccPub: 'paxipub',
                  bech32PrefixValAddr: 'paxivaloper',
                  bech32PrefixValPub: 'paxivaloperpub',
                  bech32PrefixConsAddr: 'paxivalcons',
                  bech32PrefixConsPub: 'paxivalconspub',
                },
                currencies: [ { coinDenom: 'PAXI', coinMinimalDenom: DENOM, coinDecimals: 6 } ],
                feeCurrencies: [ { coinDenom: 'PAXI', coinMinimalDenom: DENOM, coinDecimals: 6, gasPriceStep: { low: 0.01, average: 0.05, high: 0.1 } } ],
                stakeCurrency: { coinDenom: 'PAXI', coinMinimalDenom: DENOM, coinDecimals: 6 },
                features: ['cosmwasm']
              });
            }
          } catch (e) {
            // Abaikan error suggest; user masih bisa enable manual
          }
          await window.keplr.enable(CHAIN_ID);
          const signer = window.keplr.getOfflineSignerAuto ? await window.keplr.getOfflineSignerAuto(CHAIN_ID): await window.keplr.getOfflineSigner(CHAIN_ID);
          client = await SigningCosmWasmClient.connectWithSigner(RPC, signer, { prefix:'paxi', gasPrice: GasPrice.fromString('0.05'+DENOM) });
          const acc = await signer.getAccounts(); 
          address = acc[0].address; 
          setWalletPref('keplr');
          log('Connected', { address });
        } else {
          throw new Error('Wallet tidak ditemukan');
        }
        document.getElementById('connectBtn').textContent = address.slice(0,6)+'...'+address.slice(-4);
        document.getElementById('walletBox').classList.add('open');
        await refresh(); 
        await loadGallery();
        try { await updateSupply(); } catch {}
        try { await fetchGallery(); } catch {}
        await checkAdminAndTogglePanel();
      }catch(e){ log('Failed to connect: '+e.message); }
    }

    async function disconnect(){
      client = null;
      address = null;
      document.getElementById('connectBtn').textContent = 'Connect Wallet';
      document.getElementById('walletBox').classList.remove('open');
      galleryEl.innerHTML = '<p class="muted">No NFTs yet.</p>';
      log('Disconnected from wallet.');
    }

    async function mint(qty){ 
      try{ 
        if(!address) throw new Error('Connect your wallet first'); 
        qty=Math.max(1,Math.min(10,Number(qty)||1)); 
        const body = qty===1?{public_mint:{}}:{public_batch_mint:{quantity:qty}};
        log('Sending...', {qty}); 
        // PaxiHub path
        if (window.paxihub && window.paxihub.paxi) {
          const P = window.PaxiCosmJS; if(!P) throw new Error('PaxiCosmJS not ready');
          // Siapkan fee/funds
          const gas = 350000 * qty; const feeUpaxi = String(Math.ceil(gas * 0.05));
          const feeCoin = P.coins(feeUpaxi, DENOM)[0]; const fundsCoin = P.coins(String(PRICE*qty), DENOM)[0];
          // Bangun Any MsgExecuteContract
          const bodyBytes = new TextEncoder().encode(JSON.stringify(body));
          const exec = P.MsgExecuteContract.fromPartial({ sender: address, contract: CONTRACT, msg: bodyBytes, funds: [fundsCoin] });
          const anyMsg = P.Any.fromPartial({ typeUrl: '/cosmwasm.wasm.v1.MsgExecuteContract', value: P.MsgExecuteContract.encode(exec).finish() });
          // Ambil chainId & account dari LCD
          const chainId = await fetchChainIdFromLCD();
          const acc = await fetchAccountLCD(address);
          // Ambil public key dari paxihub
          const info = await window.paxihub.paxi.getAddress(); const pubkeyBytes = new Uint8Array(info.public_key||[]);
          const pubkeyAny = { typeUrl:'/cosmos.crypto.secp256k1.PubKey', value: P.PubKey.encode({ key: pubkeyBytes }).finish() };
          // Susun TxBody/AuthInfo/SignDoc
          const txBody = P.TxBody.fromPartial({ messages:[anyMsg], memo: `mint ${qty}` });
          const authInfo = P.AuthInfo.fromPartial({ signerInfos:[{ publicKey: pubkeyAny, modeInfo:{ single:{ mode:1 } }, sequence: BigInt(acc.sequence) }], fee:{ amount:[feeCoin], gasLimit: Number(gas) } });
          const signDoc = P.SignDoc.fromPartial({ bodyBytes: P.TxBody.encode(txBody).finish(), authInfoBytes: P.AuthInfo.encode(authInfo).finish(), chainId, accountNumber: BigInt(acc.accountNumber) });
          // Minta paxihub untuk sign
          const txObj = { bodyBytes: toB64(signDoc.bodyBytes), authInfoBytes: toB64(signDoc.authInfoBytes), chainId, accountNumber: signDoc.accountNumber.toString() };
          // Debug: tampilkan txObj yang akan dikirim
          try { const dc=document.getElementById('debugCard'); const doEl=document.getElementById('debugOut'); if(dc&&doEl){ dc.style.display='block'; doEl.textContent = JSON.stringify(txObj, null, 2); const tgl=document.getElementById('debugToggle'); if(tgl){ tgl.onclick=()=>{ dc.style.display='none'; }; } } } catch {}
          // Sign & broadcast via LCD
          const r = await window.paxihub.paxi.signAndSendTransaction(txObj);
          const sigB64 = r && (r.success || r.signature || r.sig || ''); if(!sigB64) throw new Error(r?.error || 'No signature returned');
          const txRaw = P.TxRaw.fromPartial({ bodyBytes: signDoc.bodyBytes, authInfoBytes: signDoc.authInfoBytes, signatures:[fromB64(sigB64)] });
          const base64Tx = toB64(P.TxRaw.encode(txRaw).finish());
          const br = await fetch(LCD.replace(/\/$/,'')+'/cosmos/tx/v1beta1/txs',{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ tx_bytes: base64Tx, mode: 'BROADCAST_MODE_SYNC' }) }).then(x=>x.json()).catch(()=>null);
          const txhash = br && br.tx_response ? (br.tx_response.txhash||'') : '';
          if (!txhash) throw new Error(br && br.tx_response && br.tx_response.raw_log ? br.tx_response.raw_log : 'Unknown broadcast error');
          log('Success',{txhash});
        } else {
          // Keplr/CosmJS path
          if(!client) throw new Error('Connect your wallet first');
          const funds=coins(PRICE*qty,DENOM); 
          const fee= calculateFee(350000*qty, GasPrice.fromString('0.05'+DENOM)); 
          const res= await client.execute(address,CONTRACT,body,fee,'mint '+qty,funds); 
          log('Success',{txhash:res.transactionHash}); 
        }
        await refresh(); 
        await loadGallery();
        try { await updateSupply(); } catch {}
        try { await fetchGallery(); } catch {}
      }catch(e){ log('Mint error: '+e.message); } 
    }

    async function loadGallery(){
      if(!address) return;
      galleryEl.innerHTML = '<p class="muted">Loading your NFTs...</p>';
      try {
        const res = await lcdSmart({ tokens: { owner: address, limit: 30 }});
        const tokens = (res && (res.tokens || res.data?.tokens || res.result?.tokens)) || [];
        if (!tokens.length) { 
          galleryEl.innerHTML = '<p class="muted">No NFTs yet.</p>'; 
          return; 
        }
        galleryEl.innerHTML = tokens.map(t=>`
          <div class="nft">
            <img data-token="${t}" src="https://api.paxinet.io/nft/${t}.png" alt="${t}">
            <p>${t}</p>
          </div>
        `).join('');
        bindGalleryImageFallback();
      } catch {
        galleryEl.innerHTML = '<p class="muted">Failed to load NFTs.</p>';
      }
    }

    // Fungsi baru: updateSupply() menampilkan "[count] / 10000 MINTED"
    async function updateSupply(){
      try {
        const parseCount = (x)=>{
          if (x == null) return 0;
          if (typeof x === 'number') return x;
          if (typeof x === 'string') return Number(x) || 0;
          if (typeof x === 'object') return Number(x.count ?? x.data?.count ?? x.result?.count ?? 0) || 0;
          return 0;
        };
        let count = 0;
        // Prefer LCD (lebih universal di PaxiHub)
        try { const r = await lcdSmart({ num_tokens: {} }); count = parseCount(r); } catch {}
        // Fallback via client jika masih 0
        if (!count && client) { try { const r2 = await client.queryContractSmart(CONTRACT, { num_tokens: {} }); count = parseCount(r2); } catch {} }
        const max = Number(maxSupply || 10000);
        supplyEl.textContent = `${count} / ${max} MINTED`;
      } catch {}
    }

    // Fungsi baru: fetchGallery() mengambil tokens dan metadata via nft_info + token_uri
    async function fetchGallery(){
      if (!address) return;
      galleryEl.innerHTML = '<p class="muted">Loading collection...</p>';
      try {
        // Ambil daftar token milik pengguna
        let tokens = [];
        if (client) {
          try {
            const r = await client.queryContractSmart(CONTRACT, { tokens: { owner: address, limit: 30 } });
            tokens = r?.tokens || [];
          } catch {}
        }
        try {
          const r = await lcdSmart({ tokens: { owner: address, limit: 30 } });
          tokens = r?.tokens || tokens;
        } catch {}

        if (!tokens.length) {
          galleryEl.innerHTML = '<p class="muted">Your collection is empty.</p>';
          return;
        }

        const toHttp = (uri) => {
          if (!uri) return '';
          return uri.startsWith('ipfs://') ? 'https://ipfs.io/ipfs/' + uri.slice('ipfs://'.length) : uri;
        };

        const cards = [];
        for (const tokenId of tokens) {
          let tokenUri = '';
          try {
            let info;
            if (client) {
              try { info = await client.queryContractSmart(CONTRACT, { nft_info: { token_id: tokenId } }); } catch {}
            }
            if (!info) { info = await lcdSmart({ nft_info: { token_id: tokenId } }); }
            tokenUri = info?.token_uri || '';
          } catch {}

          let name = tokenId;
          let image = '';
          const metaUrl = toHttp(tokenUri);
          if (metaUrl) {
            try {
              const resp = await fetch(metaUrl);
              const ct = resp.headers.get('content-type') || '';
              if (ct.includes('application/json')) {
                const meta = await resp.json();
                if (meta?.name) name = meta.name;
                if (meta?.image) image = toHttp(meta.image);
              } else if (ct.startsWith('image/')) {
                image = metaUrl;
              }
            } catch {}
          }
          if (!image) image = `https://api.paxinet.io/nft/${tokenId}.png`;
          cards.push(`
            <div class=\"nft\">\n              <img src=\"${image}\" alt=\"${name}\">\n              <p>${name}</p>\n            </div>
          `);
        }
        galleryEl.innerHTML = cards.join('');
        bindGalleryImageFallback();
      } catch {
        galleryEl.innerHTML = '<p class="muted">Failed to load NFTs.</p>';
      }
    }

    // ---- Admin Panel helpers ----
    async function queryGetConfig(){
      try { return await lcdSmart({ get_config: {} }); } catch { return null; }
    }

    async function fetchContractBalance(){
      try {
        const r = await fetch(`${LCD}/cosmos/bank/v1beta1/balances/${CONTRACT}/by_denom?denom=${DENOM}`);
        if (!r.ok) return 0;
        const js = await r.json();
        const amt = js?.balance?.amount ? Number(js.balance.amount) : 0;
        return amt;
      } catch { return 0; }
    }

    async function updateBalanceDisplay(){
      if (!balanceDisplay) return;
      const amt = await fetchContractBalance();
      balanceDisplay.textContent = `${amt} ${DENOM}`;
    }

    async function checkAdminAndTogglePanel(){
      try {
        let cfg = null;
        // Coba query via client (lebih andal dibanding decode LCD)
        if (client) {
          try { cfg = await client.queryContractSmart(CONTRACT, { get_config: {} }); } catch {}
        }
        if (!cfg) { cfg = await queryGetConfig(); }
        const connected = (address||'').trim().toLowerCase();
        const adminAddr = (cfg?.admin||'').trim().toLowerCase();
        // simpan juga ke variabel global untuk guard execAdmin
        adminAddress = cfg?.admin || null;
        const isAdmin = !!connected && !!adminAddr && connected === adminAddr;
        if (adminPanel) adminPanel.style.display = isAdmin ? 'block' : 'none';
        if (isAdmin) await updateBalanceDisplay();
      } catch {}
    }

    async function execAdmin(msg, memo){
      try{
        if(!client||!address) throw new Error('Hubungkan wallet terlebih dahulu');
        if(!adminAddress || address !== adminAddress) throw new Error('Bukan admin');
        const fee = calculateFee(400000, GasPrice.fromString('0.05'+DENOM));
        log('Mengirim...', { msg, fee });
        const res = await client.execute(address, CONTRACT, msg, fee, memo);
        log('Sukses', { txhash: res.transactionHash });
        await refresh();
        await updateBalanceDisplay();
      }catch(e){ log('Admin error: '+e.message); }
    }

    // Event handlers
    document.getElementById('connectBtn').onclick = connect;
    const mintBtnEl = document.getElementById('mint1Btn');
    if (mintBtnEl) mintBtnEl.onclick = async ()=>{
      try{
        const hasPaxi = !!(window.paxihub && window.paxihub.paxi);
        const hasProvider = !!client || hasPaxi;
        if(!address || !hasProvider){ toast('Connect your wallet first','error'); return; }
        mintBtnEl.disabled = true; mintBtnEl.textContent = 'Signing...';
        await mint(qtyEl.value);
      } finally {
        mintBtnEl.disabled = false; updateMintBtn();
      }
    };
    // Dynamic English label: Mint N Pioneers • X PAXI
    function updateMintBtn(){ const q = Math.max(1, Math.min(10, parseInt(qtyEl.value||'1',10))); const total = q*10; if(mintBtnEl) mintBtnEl.textContent = `Mint ${q} Pioneer${q>1?'s':''} • ${total} PAXI`; }
    updateMintBtn();
    // tombol refresh suplai dihapus; suplai kini otomatis diperbarui
    document.getElementById('copyBtn').onclick=()=>{ if(address){ navigator.clipboard.writeText(address); toast('Address copied','success'); } };
    document.getElementById('disconnectBtn').onclick=disconnect;
    // (removed Check Contract wiring)
    // Auto-close wallet dropdown when clicking outside or pressing ESC
    (function(){
      const box = document.getElementById('walletBox');
      const menu = document.getElementById('walletMenu');
      document.addEventListener('click', (e)=>{
        if(!box.classList.contains('open')) return;
        if(box.contains(e.target)) return; // click inside wallet area
        box.classList.remove('open');
      });
      document.addEventListener('keydown', (e)=>{
        if(e.key==='Escape') box.classList.remove('open');
      });
    })();
    if (unpauseBtn) unpauseBtn.onclick=()=>execAdmin({ unpause_mint: {} }, 'unpause');
    if (pauseBtn) pauseBtn.onclick=()=>execAdmin({ pause_mint: {} }, 'pause');
    if (withdrawBtn) withdrawBtn.onclick=()=>execAdmin({ withdraw: {} }, 'withdraw');
    // Bind new Admin Panel buttons
    if (withdrawButton) withdrawButton.onclick=()=>execAdmin({ withdraw: {} }, 'withdraw');
    if (pauseButton) pauseButton.onclick=()=>execAdmin({ pause_mint: {} }, 'pause');
    if (unpauseButton) unpauseButton.onclick=()=>execAdmin({ unpause_mint: {} }, 'unpause');
    if (updateUriButton) updateUriButton.onclick=()=>{
      const base_uri = (uriInput?.value||'').trim();
      if(!base_uri) return alert('Base URI kosong');
      return execAdmin({ update_base_uri: { base_uri } }, 'update base uri');
    };
    if (setHashButton) setHashButton.onclick=()=>{
      const hash = (hashInput?.value||'').trim();
      if(!hash) return alert('Hash kosong');
      return execAdmin({ set_provenance_hash: { hash } }, 'set provenance');
    };

    // Stepper controls untuk qty (+/-) tanpa mengubah fungsi mint
    (function(){
      const minus = document.getElementById('qtyMinus');
      const plus = document.getElementById('qtyPlus');
      if(minus) minus.onclick = ()=>{ const v=Math.max(1, Math.min(10, (parseInt(qtyEl.value||'1',10)-1))); qtyEl.value=v; updateMintBtn(); };
      if(plus) plus.onclick = ()=>{ const v=Math.max(1, Math.min(10, (parseInt(qtyEl.value||'1',10)+1))); qtyEl.value=v; updateMintBtn(); };
      qtyEl.addEventListener('input', updateMintBtn);
    })();

    // Sinkronkan progress bar dengan teks supply
    (function(){
      const fill = document.getElementById('progressFill');
      if(!fill || !supplyEl) return;
      const update = ()=>{
        const m = (supplyEl.textContent||'').match(/(\d+)\s*\/\s*(\d+)/);
        if(!m) return; const cur=Number(m[1]||0), max=Number(m[2]||0); if(!max) return; fill.style.width = Math.min(100, Math.round((cur/max)*100))+'%';
      };
      const obs = new MutationObserver(update);
      obs.observe(supplyEl, { childList:true, characterData:true, subtree:true });
      update();
    })();

    refresh();
    // panggil updateSupply saat awal
    try { updateSupply(); } catch {}
  </script>
</body>
</html>
