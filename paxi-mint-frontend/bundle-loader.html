<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paxi Pioneers (Bundel Lokal)</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin:0; background:#0d1117; color:#e6edf3; }
    .wrap { max-width: 980px; margin: 40px auto; padding: 20px; }
    .card { background:#161b22; border:1px solid #2a2f36; border-radius:12px; padding:16px; }
    .row { display:flex; gap:10px; align-items:center; margin:8px 0; justify-content:space-between }
    button { padding:10px 14px; border-radius:8px; border:1px solid #2a2f36; background:#1b2230; color:#e6edf3; cursor:pointer; }
    button.primary { background:#3b82f6; border:none; }
    input { padding:8px 10px; border-radius:8px; border:1px solid #2a2f36; background:#0f1419; color:#e6edf3; }
    .muted { color:#8ea1c0; font-size:13px; }
    pre { background:#0f1419; color:#e6edf3; padding:10px; border-radius:8px; overflow:auto; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="row"><h2>Paxi Pioneers (Bundel Lokal)</h2><button id="connectBtn">Hubungkan Keplr</button></div>
    <div class="card">
      <div class="row"><div>
        <label>Kuantitas</label>
        <input id="qty" type="number" min="1" max="10" value="1" />
      </div>
      <div>
        <button id="mint1Btn" class="primary">Mint 1</button>
        <button id="mintBatchBtn" class="primary">Mint Batch</button>
      </div></div>
      <div class="row"><button id="refreshBtn">Perbarui Suplai</button><span id="supply" class="muted"></span></div>
      <pre id="log">Siap.</pre>
    </div>
  </div>

  <script src="bundle.js"></script>
  <script>
    const CONTRACT = 'paxi1rnraxu54huv7wkmpff3v8mzhqh49g0e60x4ehzws4ee6upcy78sqc55vx0';
    const RPC = 'https://testnet-rpc.paxinet.io';
    const LCD = 'https://testnet-lcd.paxinet.io';
    const CHAIN_ID = 'paxi-testnet';
    const DENOM = 'upaxi';
    const PRICE = 10_000_000;

    const { SigningCosmWasmClient, GasPrice, calculateFee, coins } = window.Cosm;
    const logEl = document.getElementById('log');
    const supplyEl = document.getElementById('supply');
    const qtyEl = document.getElementById('qty');
    let client=null, address=null;
    const log=(m,o)=>{ logEl.textContent=m+(o?'\n'+JSON.stringify(o,null,2):''); };

    const lcdSmart = (q)=> fetch(`${LCD}/cosmwasm/wasm/v1/contract/${CONTRACT}/smart/${btoa(JSON.stringify(q))}`)
      .then(r=>{ if(!r.ok) throw new Error('LCD '+r.status); return r.json(); })
      .then(js=>{ const b64=js.data||js.result||js.smart||js.result_data||js.response?.data; if(!b64) return js; const bytes=Uint8Array.from(atob(b64),c=>c.charCodeAt(0)); try{ return JSON.parse(new TextDecoder().decode(bytes)); }catch{return{};} });

    async function refresh(){ try{ const r=await lcdSmart({num_tokens:{}}); supplyEl.textContent=`Supply: ${Number(r.count||r||0)} / 10000`; }catch{ supplyEl.textContent='Supply: --'; } }

    async function connect(){
      try{
        if(!window.keplr) throw new Error('Keplr tidak ditemukan');
        try{ await window.keplr.enable(CHAIN_ID); }catch{ /* suggest chain opsional jika perlu */ }
        const signer = window.keplr.getOfflineSignerAuto? await window.keplr.getOfflineSignerAuto(CHAIN_ID): await window.keplr.getOfflineSigner(CHAIN_ID);
        client = await SigningCosmWasmClient.connectWithSigner(RPC, signer, { prefix:'paxi', gasPrice: GasPrice.fromString('0.05'+DENOM) });
        const acc = await signer.getAccounts(); address = acc[0].address; log('Terhubung', { address }); await refresh();
      }catch(e){ log('Gagal connect: '+e.message); }
    }

    async function mint(qty){ try{ if(!client||!address) throw new Error('Hubungkan wallet terlebih dahulu'); qty=Math.max(1,Math.min(10,Number(qty)||1)); const funds=coins(PRICE*qty,DENOM); const fee= calculateFee(350000*qty, GasPrice.fromString('0.05'+DENOM)); const msg= qty===1?{public_mint:{}}:{public_batch_mint:{quantity:qty}}; log('Mengirim...', {qty,funds,fee}); const res= await client.execute(address,CONTRACT,msg,fee,'mint '+qty,funds); log('Sukses',{txhash:res.transactionHash}); await refresh(); }catch(e){ log('Mint error: '+e.message); } }

    document.getElementById('connectBtn').onclick=connect;
    document.getElementById('mint1Btn').onclick=()=>mint(1);
    document.getElementById('mintBatchBtn').onclick=()=>mint(qtyEl.value);
    document.getElementById('refreshBtn').onclick=refresh;
    refresh();
  </script>
</body>
</html>

